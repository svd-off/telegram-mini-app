<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Городской Транспорт</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: #000; color: #FFF; height: 100vh; overflow: hidden; }
        .app-container { height: 100%; display: flex; flex-direction: column; padding: 16px; }
        .page { display: none; flex-direction: column; height: 100%; }
        .page.active { display: flex; }

        /* === ЭКРАН 3 — ФИНАЛЬНЫЙ БИЛЕТ — 1 В 1 КАК НА СКРИНЕ === */
        .final-ticket { flex: 1; display: flex; flex-direction: column; }
        .timer { font-size: 24px; font-weight: 600; text-align: center; margin: 20px 0 32px; color: #FFF; }
        
        .ticket-header-row {
            display: flex; justify-content: space-between; align-items: center;
            padding-bottom: 16px; border-bottom: 1px solid #333; margin-bottom: 32px;
        }
        .ticket-number {
            font-size: 20px; font-weight: 600; color: #FF3B30;
            display: flex; align-items: center;
        }
        .ticket-number svg { width: 24px; height: 24px; margin-right: 8px; fill: #FF3B30; }
        .control { display: flex; align-items: center; font-size: 16px; color: #AAA; }
        .control svg { width: 20px; height: 20px; margin-right: 6px; fill: #AAA; }

        .ticket-info { flex: 1; }
        .info-row {
            display: flex;
            align-items: flex-start;
            margin-bottom: 24px;
            font-size: 16px;
        }
        .info-icon {
            width: 32px; height: 32px;
            margin-right: 16px;
            flex-shrink: 0;
        }
        .info-label {
            font-size: 13px;
            color: #AAA;
            margin-bottom: 4px;
        }
        .info-value {
            font-size: 16px;
            font-weight: 500;
            color: #FFF;
        }
        .route-code { margin-top: 4px; color: #AAA; }

        .close-button {
            background: #FF3B30;
            color: #FFF;
            font-size: 18px;
            font-weight: 600;
            padding: 18px;
            border-radius: 16px;
            text-align: center;
            margin-top: 24px;
            cursor: pointer;
        }
        .close-button:active { background: #D70015; }

        /* Остальные стили (1 и 2 экраны + список билетов) — оставил как было, только подправил мелкие отступы */
        .active-ticket-item { background: #1E1E1E; border-radius: 12px; padding: 16px; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between; }
        .active-ticket-item:active { background: #2A2A2C; }
        .delete-btn { width: 32px; height: 32px; background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23FF3B30" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>') center/20px no-repeat; cursor: pointer; }
    </style>
</head>
<body>
    <div class="app-container">

        <!-- ЭКРАН 3 — ФИНАЛЬНЫЙ БИЛЕТ — 100% КАК НА СКРИНЕ -->
        <div id="finalTicketPage" class="page">
            <div class="final-ticket">
                <div class="timer" id="timer">Действует: 15 сек.</div>

                <div class="ticket-header-row">
                    <div class="ticket-number">
                        <svg viewBox="0 0 24 24"><path d="M9 17h6m-6-4h6m-6-4h6M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/></svg>
                        <span id="currentTicketNumber">1 299 814 483</span>
                    </div>
                    <div class="control" onclick="switchToControl()">
                        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16h.01M12 12h.01M12 8h.01"/></svg>
                        Контроль
                    </div>
                </div>

                <div class="ticket-info">
                    <div class="info-row">
                        <div class="info-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        </div>
                        <div>
                            <div class="info-label">Перевозчик</div>
                            <div class="info-value">ИП Галченкова Е. А.</div>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="info-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                        </div>
                        <div>
                            <div class="info-label">ст. Красноярск-Северный - ДК Кировский</div>
                            <div class="info-value route-code">к378тв124</div>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="info-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9 12h6"/></svg>
                        </div>
                        <div>
                            <div class="info-label">Стоимость</div>
                            <div class="info-value">1 шт., Полный, 48.00 ₽</div>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="info-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                        </div>
                        <div>
                            <div class="info-label">Дата покупки</div>
                            <div class="info-value"><span id="purchaseDate">15 ноября 2025 г.</span></div>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="info-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        </div>
                        <div>
                            <div class="info-label">Время покупки</div>
                            <div class="info-value"><span id="purchaseTime">12:08</span></div>
                        </div>
                    </div>
                </div>

                <div class="close-button" onclick="closeTicket()">ЗАКРЫТЬ</div>
            </div>
        </div>

        <!-- Остальные страницы (ввод кода, оплата, список билетов) — оставил как было, только мелкие правки под стиль -->
        <!-- Вставь сюда свои старые блоки #codeInputPage, #paymentPage, #activeTicketsPage — они у тебя уже есть -->
        
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.hide();

        let viewSecondsLeft = 15;
        let viewTimer;

        function startViewTimer() {
            viewSecondsLeft = 15;
            updateViewTimer();
            clearInterval(viewTimer);
            viewTimer = setInterval(() => {
                viewSecondsLeft--;
                updateViewTimer();
                if (viewSecondsLeft <= 0) {
                    clearInterval(viewTimer);
                    showPage('activeTicketsPage');
                    renderActiveTickets();
                }
            }, 1000);
        }

        function updateViewTimer() {
            document.getElementById('timer').textContent = `Действует: ${viewSecondsLeft} сек.`;
        }

        function closeTicket() {
            clearInterval(viewTimer);
            showPage('activeTicketsPage');
            renderActiveTickets();
        }

        // При открытии билета из списка — ставим правильный номер
        window.openFinalTicket = function(number) {
            document.getElementById('currentTicketNumber').textContent = number;
            showPage('finalTicketPage');
            startViewTimer();
        };

        // Инициализация даты/времени
        document.addEventListener('DOMContentLoaded', () => {
            const now = new Date();
            document.getElementById('purchaseDate').textContent = now.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' }) + ' г.';
            document.getElementById('purchaseTime').textContent = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
        });
    </script>
</body>
</html>
