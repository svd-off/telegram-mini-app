<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Городской Транспорт</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#000; color:#FFF; height:100vh; overflow:hidden; }
        .app-container { height:100%; display:flex; flex-direction:column; padding:16px; }
        .page { display:none; flex-direction:column; height:100%; }
        .page.active { display:flex; }

        /* ЭКРАН 1 — ВВОД КОДА */
        .code-input-field { display:flex; justify-content:center; gap:8px; margin-bottom:40px; }
        .code-box { width:48px; height:64px; border-radius:12px; background:#1E1E1E; border:1px solid #3A3A3C; display:flex; align-items:center; justify-content:center; font-size:28px; font-weight:600; color:#FFF; }
        .code-box.filled { background:#FFF; color:#000; }

        .header { display:flex; align-items:center; justify-content:center; margin-bottom:40px; }
        .header-icon { width:24px; height:24px; background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 9h.01M15 15h.01M9 15h.01M15 9h.01"/></svg>') center/contain no-repeat; margin-right:8px; }
        .header-title { font-size:18px; font-weight:600; }

        .keyboard-container { background:#111; border-radius:16px; padding:16px; }
        .keyboard { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
        .key { background:#FFF; color:#000; border-radius:12px; font-size:32px; font-weight:600; height:72px; display:flex; align-items:center; justify-content:center; cursor:pointer; user-select:none; }
        .key:active { background:#E0E0E0; transform:scale(0.98); }

        .bottom-row { display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; margin-top:12px; }
        .scan-btn { background:#2A2A2A; color:#FFF; border-radius:12px; font-size:18px; font-weight:600; display:flex; align-items:center; justify-content:center; gap:8px; }
        .scan-btn:active { background:#3A3A3A; }
        .zero-btn { background:#FFF; color:#000; border-radius:12px; font-size:32px; font-weight:600; display:flex; align-items:center; justify-content:center; }
        .delete-btn { background:#2A2A2A; border-radius:12px; display:flex; align-items:center; justify-content:center; }
        .delete-btn:active { background:#3A3A3A; }

        .error-message { color:#FF3B30; font-size:16px; text-align:center; margin-top:20px; display:none; }

        /* Остальные экраны — оставил как было, только подогнал под новый стиль */
        .ticket-header { display:flex; align-items:center; margin-bottom:24px; font-size:18px; font-weight:600; }
        .ticket-header svg { width:24px; height:24px; margin-right:8px; fill:#FFF; }
        .section { margin-bottom:24px; padding-bottom:16px; border-bottom:1px solid #333; }
        .section-title { display:flex; align-items:center; margin-bottom:8px; font-size:14px; color:#AAA; }
        .section-title svg { width:18px; height:18px; margin-right:8px; fill:#AAA; }
        .section-content { font-size:16px; font-weight:500; color:#FFF; }
        .input-field { background:#1E1E1E; border:1px solid #3A3A3C; border-radius:12px; padding:14px; color:#FFF; font-size:16px; margin-bottom:16px; }
        .quantity-slider { display:flex; align-items:center; margin:16px 0; }
        .quantity-slider input[type="range"] { -webkit-appearance:none; flex:1; height:4px; background:#333; border-radius:2px; outline:none; margin:0 12px; }
        .quantity-slider input[type="range"]::-webkit-slider-thumb { -webkit-appearance:none; width:20px; height:20px; background:#FF3B30; border-radius:50%; cursor:pointer; }
        .quantity-value { font-size:18px; font-weight:600; color:#FF3B30; }
        .pay-button { background:#30D158; color:#000; font-size:18px; font-weight:600; padding:18px; border-radius:16px; text-align:center; margin-top:auto; cursor:pointer; }
        .pay-button:active { background:#28A745; }

        .final-ticket { flex:1; display:flex; flex-direction:column; padding:20px 0; }
        .timer { font-size:24px; font-weight:600; text-align:center; margin-bottom:36px; }
        .ticket-number { display:flex; align-items:center; justify-content:center; margin-bottom:36px; font-size:21px; font-weight:600; color:#FF3B30; }
        .ticket-number svg { width:32px; height:32px; margin-right:12px; fill:#FF3B30; }
        .ticket-number span { letter-spacing:4px; }
        .info-row { display:flex; align-items:flex-start; margin-bottom:32px; gap:18px; }
        .info-icon { width:28px; height:28px; fill:#AAA; flex-shrink:0; }
        .info-label { font-size:13px; color:#AAA; margin-bottom:6px; }
        .info-value { font-size:18px; font-weight:500; color:#FFF; }
        .close-button { background:#FF3B30; color:#FFF; font-size:18px; font-weight:600; padding:20px; border-radius:16px; text-align:center; cursor:pointer; }
        .close-button:active { background:#D70015; }

        .active-tickets-list { flex:1; overflow-y:auto; }
        .active-ticket-item { background:#1E1E1E; border-radius:12px; padding:16px; margin-bottom:12px; display:flex; align-items:center; justify-content:space-between; cursor:pointer; }
        .active-ticket-item:active { background:#2A2A2A; }
        .active-ticket-item .ticket-number { font-size:18px; font-weight:600; color:#FF3B30; }
        .active-tickets-list .ticket-number { font-size:18px; font-weight:600; color:#FF3B30; }
        .active-tickets-list .ticket-time { font-size:14px; color:#AAA; margin-top:4px; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ЭКРАН 1 — ВВОД КОДА -->
        <div id="codeInputPage" class="page active">
            <div class="code-input-field" id="codeDisplay">
                <div class="code-box"></div>
                <div class="code-box"></div>
                <div class="code-box"></div>
                <div class="code-box"></div>
                <div class="code-box"></div>
                <div class="code-box"></div>
            </div>

            <div class="header">
                <svg viewBox="0 0 24 24" style="width:24px; height:24px; margin-right:8px; fill:#FFF;">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <path d="M9 9h.01M15 15h.01M9 15h.01M15 9h.01"/>
                </svg>
                <div class="header-title">Введите код с наклейки</div>
            </div>

            <div class="keyboard-container">
                <div class="keyboard">
                    <button class="key" onclick="addNumber(1)">1</button>
                    <button class="key" onclick="addNumber(2)">2</button>
                    <button class="key" onclick="addNumber(3)">3</button>
                    <button class="key" onclick="addNumber(4)">4</button>
                    <button class="key" onclick="addNumber(5)">5</button>
                    <button class="key" onclick="addNumber(6)">6</button>
                    <button class="key" onclick="addNumber(7)">7</button>
                    <button class="key" onclick="addNumber(8)">8</button>
                    <button class="key" onclick="addNumber(9)">9</button>
                </div>

                <div class="bottom-row">
                    <button class="action-btn scan-btn" onclick="scanCode()">
                        <svg viewBox="0 0 24 24" style="width:24px; height:24px; fill:#FFF;">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <path d="M9 9h.01M15 15h.01M9 15h.01M15 9h.01"/>
                        </svg>
                        Сканировать
                    </button>
                    <button class="key" onclick="addNumber(0)">0</button>
                    <button class="action-btn" onclick="backspace()">
                        <svg viewBox="0 0 24 24" style="width:24px; height:24px; fill:#FFF;">
                            <path d="M19 12H5m7-7-7 7 7 7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- ЭКРАН 2 — ОПЛАТА -->
        <div id="paymentPage" class="page">
            <div class="ticket-header">
                <svg viewBox="0 0 24 24" style="width:24px; height:24px; fill:#FFF; margin-right:8px;">
                    <path d="M9 12h6m-6-4h6m-6 4h6m4-10V8a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z"/>
                </svg>
                <div class="header-title">Данные билета</div>
            </div>

            <input type="text" class="input-field" id="carrierInput" placeholder="Перевозчик" value="ИП Галченкова Е. А.">
            <input type="text" class="input-field" id="routeInput" placeholder="Маршрут" value="7, ст. Красноярск-Северный - ДК Кировский">
            <input type="text" class="input-field" id="busNumberInput" placeholder="Номер автобуса" value="к378тв124">

            <div class="quantity-section" style="margin:24px 0;">
                <div class="section-title">Количество билетов</div>
                <div class="quantity-slider">
                    <span class="quantity-value">1</span>
                    <input type="range" min="1" max="10" value="1" id="quantityRange" onchange="updateQuantity()">
                    <span class="quantity-value">10</span>
                </div>
            </div>

            <div class="pay-button" onclick="payTicket()">ОПЛАТИТЬ — 48.00 ₽</div>
        </div>

        <!-- ЭКРАН 3 — ФИНАЛЬНЫЙ БИЛЕТ -->
        <div id="finalTicketPage" class="page">
            <div class="final-ticket">
                <div class="timer">Действует: 90 сек.</div>
                <div class="ticket-number">
                    <svg viewBox="0 0 24 24" style="width:32px; height:32px; fill:#FF3B30;">
                        <path d="M9 17h6m-6-4h6m-6-4h6M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14z"/>
                    </svg>
                    <span id="finalTicketNumber">1 299 814 483</span>
                </div>

                <div class="info-row">
                    <svg viewBox="0 0 24 24" style="width:24px; height:24px; fill:#AAA;">
                        <path d="M20 21l-4.35-4.35M18.5 10.5a8 8 0 1 1-16 0 8 8 0 0 1 16 0z"/>
                    </svg>
                    <span class="info-value">ИП Галченкова Е. А.</span>
                </div>

                <div class="info-row">
                    <svg viewBox="0 0 24 24" style="width:24px; height:24px; fill:#AAA;">
                        <path d="M19 21l-4.35-4.35M18.5 10.5a8 8 0 1 1-16 0 8 8 0 0 1 16 0z"/>
                    </svg>
                    <span class="info-value">7, ст. Красноярск-Северный - ДК Кировский<br>к378тв124</span>
                </div>

                <div class="info-row">
                    <svg viewBox="0 0 24 24" style="width:24px; height:24px; fill:#AAA;">
                        <path d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18zM12 3v18"/>
                    </svg>
                    <span class="info-value">1 шт., Полный, 48.00 ₽</span>
                </div>

                <div class="info-row">
                    <svg viewBox="0 0 24 24" style="width:24px; height:24px; fill:#AAA;">
                        <path d="M19 21l-4.35-4.35M18.5 10.5a8 8 0 1 1-16 0 8 8 0 0 0 0 18z"/>
                    </svg>
                    <span class="info-value">15 ноября 2025 г.</span>
                </div>

                <div class="info-row">
                    <svg viewBox="0 0 24 24" style="width:24px; height:24px; fill:#AAA;">
                        <path d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18zM12 3v18"/>
                    </svg>
                    <span class="info-value">12:08</span>
                </div>
            </div>
            <div class="close-button" onclick="closeTicket()">ЗАКРЫТЬ</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.hide();

        let enteredCode = '';
        const maxCodeLength = 6;

        const tickets = [];

        function addNumber(number) {
            if (enteredCode.length < maxCodeLength) {
                enteredCode += number;
                updateCodeDisplay();
                if (enteredCode.length === maxCodeLength) {
                    setTimeout(() => {
                        showPage('paymentPage');
                    }, 300);
                }
            }
        }

        function backspace() {
            enteredCode = enteredCode.slice(0, -1);
            updateCodeDisplay();
        }

        function updateCodeDisplay() {
            const boxes = document.querySelectorAll('.code-box');
            boxes.forEach((box, index) => {
                if (index < enteredCode.length) {
                    box.textContent = enteredCode[index];
                    box.classList.add('filled');
                } else {
                    box.textContent = '';
                    box.classList.remove('filled');
                }
            });
        }

        function scanCode() {
            tg.showScanQrPopup({}, function (text) {
                showPage('paymentPage');
            });
        }

        function payTicket() {
            const ticketNumber = `1 ${randomNumber()} ${randomNumber()} ${randomNumber()}`;
            const ticketsList = document.getElementById('ticketsList');
            ticketsList.innerHTML = `<div class="ticket-item" onclick="showPage('finalTicketPage')">
                <div class="ticket-number">Билет № ${ticketNumber}</div>
                <div class="ticket-time">Осталось: 90 мин</div>
            </div>` + ticketsList.innerHTML;

            showPage('finalTicketPage');
        }

        function randomNumber() {
            return Math.floor(Math.random() * 900) + 100;
        }

        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function showError() {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.style.display = 'block';
            setTimeout(() => {
                enteredCode = '';
                updateCodeDisplay();
                errorMessage.style.display = 'none';
            }, 1500);
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateCodeDisplay();
        });
    </script>
</body>
</html>
